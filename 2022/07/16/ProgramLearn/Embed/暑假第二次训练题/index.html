<!DOCTYPE html>
<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 6.0.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"180.76.50.251","root":"/","scheme":"Pisces","version":"7.8.0","exturl":false,"sidebar":{"position":"right","display":"always","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta name="description" content="一、系统方案1.1  方案的比较与选择(1) 取样电阻接入方法的选择i. 使用模拟开关进行接入切换优点： 可以做到一路输入控制多路输出，有集成芯片，体积、发热较小。 缺点： 只能应对电细微变化而且没有电平差别的场景，同时自身带有阻抗，通入高频时输出响应变化难以通过计算得到平衡，尤其是在相位特征上。 ii.使用继电器进行接入切换优点： 带载能力达，没有触点，寿命长，不受使用环境限制。 缺点： 控制电">
<meta property="og:type" content="article">
<meta property="og:title" content="暑假第二次训练题最终报告">
<meta property="og:url" content="http://180.76.50.251/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/index.html">
<meta property="og:site_name" content="MAL&#39;S_BLOG">
<meta property="og:description" content="一、系统方案1.1  方案的比较与选择(1) 取样电阻接入方法的选择i. 使用模拟开关进行接入切换优点： 可以做到一路输入控制多路输出，有集成芯片，体积、发热较小。 缺点： 只能应对电细微变化而且没有电平差别的场景，同时自身带有阻抗，通入高频时输出响应变化难以通过计算得到平衡，尤其是在相位特征上。 ii.使用继电器进行接入切换优点： 带载能力达，没有触点，寿命长，不受使用环境限制。 缺点： 控制电">
<meta property="og:locale">
<meta property="og:image" content="http://180.76.50.251/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/系统框图-16575399219541.png">
<meta property="og:image" content="http://180.76.50.251/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220711194647584.png">
<meta property="og:image" content="http://180.76.50.251/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220711195608205.png">
<meta property="og:image" content="http://180.76.50.251/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220711195654269.png">
<meta property="og:image" content="http://180.76.50.251/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220711200131566.png">
<meta property="og:image" content="http://180.76.50.251/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220711200650035.png">
<meta property="og:image" content="http://180.76.50.251/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220711202233299.png">
<meta property="og:image" content="http://180.76.50.251/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/0dd7912397dda14436109687b0b7d0a20cf486ee.jpg">
<meta property="og:image" content="http://180.76.50.251/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220711212641617.png">
<meta property="og:image" content="http://180.76.50.251/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220712000025404.png">
<meta property="article:published_time" content="2022-07-16T10:00:53.000Z">
<meta property="article:modified_time" content="2022-07-16T14:00:26.859Z">
<meta property="article:author" content="MALossov">
<meta property="article:tag" content="编程学习,STM32,嵌入式">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://180.76.50.251/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/系统框图-16575399219541.png">

<link rel="canonical" href="http://180.76.50.251/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-Hans'
  };
</script>

  <title>暑假第二次训练题最终报告 | MAL'S_BLOG</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

<style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">MAL'S_BLOG</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Welcome to Malossov's Personal Archieve!</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-主页">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>主页</a>

  </li>
        <li class="menu-item menu-item-标签">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-分类">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-归档">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-友链">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>

    <li> <a title="把这个链接拖到你的Chrome收藏夹工具栏中" href='javascript:(function() {
    function c() {
        var e = document.createElement("link");
        e.setAttribute("type", "text/css");
        e.setAttribute("rel", "stylesheet");
        e.setAttribute("href", f);
        e.setAttribute("class", l);
        document.body.appendChild(e)
    }

    function h() {
        var e = document.getElementsByClassName(l);
        for (var t = 0; t < e.length; t++) {
            document.body.removeChild(e[t])
        }
    }

    function p() {
        var e = document.createElement("div");
        e.setAttribute("class", a);
        document.body.appendChild(e);
        setTimeout(function() {
            document.body.removeChild(e)
        }, 100)
    }

    function d(e) {
        return {
            height : e.offsetHeight,
            width : e.offsetWidth
        }
    }

    function v(i) {
        var s = d(i);
        return s.height > e && s.height < n && s.width > t && s.width < r
    }

    function m(e) {
        var t = e;
        var n = 0;
        while (!!t) {
            n += t.offsetTop;
            t = t.offsetParent
        }
        return n
    }

    function g() {
        var e = document.documentElement;
        if (!!window.innerWidth) {
            return window.innerHeight
        } else if (e && !isNaN(e.clientHeight)) {
            return e.clientHeight
        }
        return 0
    }

    function y() {
        if (window.pageYOffset) {
            return window.pageYOffset
        }
        return Math.max(document.documentElement.scrollTop, document.body.scrollTop)
    }

    function E(e) {
        var t = m(e);
        return t >= w && t <= b + w
    }

    function S() {
        var e = document.createElement("audio");
        e.setAttribute("class", l);
        e.src = i;
        e.loop = false;
        e.addEventListener("canplay", function() {
            setTimeout(function() {
                x(k)
            }, 500);
            setTimeout(function() {
                N();
                p();
                for (var e = 0; e < O.length; e++) {
                    T(O[e])
                }
            }, 15500)
        }, true);
        e.addEventListener("ended", function() {
            N();
            h()
        }, true);
        e.innerHTML = " <p>If you are reading this, it is because your browser does not support the audio element. We recommend that you get a new browser.</p> <p>";
        document.body.appendChild(e);
        e.play()
    }

    function x(e) {
        e.className += " " + s + " " + o
    }

    function T(e) {
        e.className += " " + s + " " + u[Math.floor(Math.random() * u.length)]
    }

    function N() {
        var e = document.getElementsByClassName(s);
        var t = new RegExp("\\b" + s + "\\b");
        for (var n = 0; n < e.length; ) {
            e[n].className = e[n].className.replace(t, "")
        }
    }

    var e = 30;
    var t = 30;
    var n = 350;
    var r = 350;
    var i = "//7xuupy.com1.z0.glb.clouddn.com/tongxingSibel%20-%20Im%20Sorry.mp3";
    var s = "mw-harlem_shake_me";
    var o = "im_first";
    var u = ["im_drunk", "im_baked", "im_trippin", "im_blown"];
    var a = "mw-strobe_light";
    var f = "//s3.amazonaws.com/moovweb-marketing/playground/harlem-shake-style.css";
    var l = "mw_added_css";
    var b = g();
    var w = y();
    var C = document.getElementsByTagName("*");
    var k = null;
    for (var L = 0; L < C.length; L++) {
        var A = C[L];
        if (v(A)) {
            if (E(A)) {
                k = A;
                break
            }
        }
    }
    if (A === null) {
        console.warn("Could not find a node of the right size. Please try a different page.");
        return
    }
    c();
    S();
    var O = [];
    for (var L = 0; L < C.length; L++) {
        var A = C[L];
        if (v(A)) {
            O.push(A)
        }
    }
    })()    '>High一下</a> </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-Hans">
    <link itemprop="mainEntityOfPage" href="http://180.76.50.251/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avator.png">
      <meta itemprop="name" content="MALossov">
      <meta itemprop="description" content="是很菜的人的很菜的博客捏，无栈工程学徒ing。">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="MAL'S_BLOG">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          暑假第二次训练题最终报告
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2022-07-16 18:00:53 / Modified: 22:00:26" itemprop="dateCreated datePublished" datetime="2022-07-16T18:00:53+08:00">2022-07-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%A1%AC%E4%BB%B6/" itemprop="url" rel="index"><span itemprop="name">硬件</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="一、系统方案"><a href="#一、系统方案" class="headerlink" title="一、系统方案"></a>一、系统方案</h2><h3 id="1-1-方案的比较与选择"><a href="#1-1-方案的比较与选择" class="headerlink" title="1.1  方案的比较与选择"></a>1.1  方案的比较与选择</h3><h4 id="1-取样电阻接入方法的选择"><a href="#1-取样电阻接入方法的选择" class="headerlink" title="(1) 取样电阻接入方法的选择"></a>(1) 取样电阻接入方法的选择</h4><h5 id="i-使用模拟开关进行接入切换"><a href="#i-使用模拟开关进行接入切换" class="headerlink" title="i. 使用模拟开关进行接入切换"></a>i. 使用模拟开关进行接入切换</h5><p><strong>优点：</strong> 可以做到一路输入控制多路输出，有集成芯片，体积、发热较小。</p>
<p><strong>缺点：</strong> 只能应对电细微变化而且没有电平差别的场景，同时自身带有阻抗，通入高频时输出响应变化难以通过计算得到平衡，尤其是在相位特征上。</p>
<h5 id="ii-使用继电器进行接入切换"><a href="#ii-使用继电器进行接入切换" class="headerlink" title="ii.使用继电器进行接入切换"></a>ii.使用继电器进行接入切换</h5><p><strong>优点：</strong> 带载能力达，没有触点，寿命长，不受使用环境限制。</p>
<p><strong>缺点：</strong> 控制电流不能太大，仅能分出两路电流，由于是电磁结构，无法做到高频切换。</p>
<p><strong>总结</strong>：由于本题中，通过取样电阻和电路的电流为频率可能较高的直流、交流混合信号，如果采用模拟开关，可能会产生额外阻抗，不利于输入、输出电阻的系统计算。同时，该系统中，通过取样电阻的电流较小，使用继电器可以满足需求。</p>
<h4 id="2-处理器方案的选择"><a href="#2-处理器方案的选择" class="headerlink" title="(2)  处理器方案的选择"></a>(2)  处理器方案的选择</h4><h5 id="i-使用STM32F1系列MCU"><a href="#i-使用STM32F1系列MCU" class="headerlink" title="i.使用STM32F1系列MCU"></a>i.使用STM32F1系列MCU</h5><p><strong>优点：</strong> 价格便宜，参考资料众多，编程方便。多次使用，外设熟悉。</p>
<p><strong>缺点：</strong> 主频不高，ADC采样频率不高。对于DSP相关数学计算支持较差，仅有汇编FFT库可以使用，如果使用滤波器和加窗函数无法较好支持。同时片上SRAM较小，可能会因为加入大数组的原因导致内存溢出。</p>
<h5 id="ii-使用STM32H7系列产品线"><a href="#ii-使用STM32H7系列产品线" class="headerlink" title="ii.使用STM32H7系列产品线"></a>ii.使用STM32H7系列产品线</h5><p><strong>优点：</strong> 主频较高，片上资源多，内核支持ARM的DSP库，可以进行复杂的矩阵、滤波器、开方求模运算。</p>
<p><strong>缺点：</strong> 资料较少，内核提升带来的结果为编程复杂度的提升，同时参考资料较少而且价格昂贵。</p>
<p><strong>结论：</strong> 本题中，要求进行扫频来求幅频特性，如果不使用较为简单粗暴的峰峰值方法计算电压幅度，则可能在扫频频率较高时<strong>STM32F1</strong> 的ADC的计算功能无法跟上采样节奏，同时在本题基础上，如果出现更高难度指标，必定要用到FFT，在这次训练题中进行提前的准备。</p>
<h4 id="3-模数转换器的选择"><a href="#3-模数转换器的选择" class="headerlink" title="(3)  模数转换器的选择"></a>(3)  模数转换器的选择</h4><h5 id="i-使用片外ADC采样"><a href="#i-使用片外ADC采样" class="headerlink" title="i.使用片外ADC采样"></a>i.使用片外ADC采样</h5><h6 id="a-使用ADS1256"><a href="#a-使用ADS1256" class="headerlink" title="a)使用ADS1256"></a>a)使用ADS1256</h6><p><strong>优点：</strong> 1256精度较高。</p>
<p><strong>缺点：</strong> 采样速率较低，无法同步采样。同时1256的校准较为困难，气温、电压不一样将导致电压下降。同时可测范围由于打开<em>Buffer</em>的影响而和片内采样范围一致。同时可采频率选择范围较窄，仅能够达到30Kps。</p>
<h6 id="b-使用AD7606"><a href="#b-使用AD7606" class="headerlink" title="b)使用AD7606"></a>b)使用AD7606</h6><p><strong>优点：</strong> 同步采样。</p>
<p><strong>缺点：</strong> 采样速率依旧无法满足扫频判断指标需要的500kps，最高位200kps。并且之前未使用过该模块，使用该模块的学习和时间成本均较大。</p>
<h5 id="ii-使用片上ADC采样"><a href="#ii-使用片上ADC采样" class="headerlink" title="ii.使用片上ADC采样"></a>ii.使用片上ADC采样</h5><p><strong>优点：</strong> 驱动容易，可以轻松的读入DMA。</p>
<p><strong>缺点</strong>：如上所述，我们采用的STM32H7B0作为MCU，使用的16Bit-SAR型ADC，这种ADC的结构不同于Σ-δ型，真实分辨率并未达到16位，而是仅仅为14位左右。同时，如果使用STM32进行同步采样，则不得不面对出现<em>假同步</em>的情况，在采样率为500kps的时候，其同幅误差可能达到16°。</p>
<p><strong>总结：</strong> 使用STM32H7的片上ADC，其拥有最高可达2M的高采样率和可以通过过采样达到的16位精度，同时其<em>假同步</em>的缺陷可以通过手动算相得到修正，也不会影响幅值的计算。</p>
<h3 id="1-2-方案描述"><a href="#1-2-方案描述" class="headerlink" title="1.2 方案描述"></a>1.2 方案描述</h3><p><strong>综上所述，</strong> 在本题中，我们采用继电器控制取样电阻的接入，利用DDS产生基波后经过衰减器衰减到一个合适的可以输入三极管电路的信号，之后在输出端再经过衰减获得一个STM32易于采样的电压幅度范围。</p>
<p>通过STM32单片机程序修改频率控制字和幅度控制字实现激励输出信号的频率和幅度调节，输入被测网络。通过提高DDS输出幅度与固定衰减器配合工作提高输出信号的信噪比，被测网络输出信号通过继电器选择是否连接交流负载，可分别测量空载电压和带载电压等。</p>
<p>输出信号经片上16bit模数转换器转换后输入STM32，经分析计算后，得到被测网络的各项电路参数，将结果显示在串口触摸屏。</p>
<p><img src="/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/系统框图-16575399219541.png" alt="系统框图" style="zoom:50%;"></p>
<p>系统框图如上。</p>
<h2 id="二、理论分析与计算"><a href="#二、理论分析与计算" class="headerlink" title="二、理论分析与计算"></a>二、理论分析与计算</h2><h3 id="2-1-待测电路"><a href="#2-1-待测电路" class="headerlink" title="2.1  待测电路"></a>2.1  待测电路</h3><p>待测电路由题目给出，为一个三极管放大器反向放大器。基础部分为需要设计检测仪能够检测放大电路的输入电阻、输出电阻、增益和频幅特性曲线，由于搭建的反向放大电路只有一个输入输出端口，所以不能采用一般的方式去求出我们需要的。我们必须采用其他方式来获取我们所需要的。</p>
<p><img src="/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220711194647584.png" alt="image-20220711194647584" style="zoom:50%;"></p>
<p>在这里我们采用继电器的方式来搭建电路实验课中我们常见的输入输出电阻测量电路，通过在输入端串联采样电阻，以及在输出端并联采样电阻，我们能够通过二次电压法得到输入，输出电阻。</p>
<p>如下二图所示，输入和通过S7和S8，可以改变原电路与采样电阻之间的连接关系，我们能够通过测量输入、输出电阻两端电压确定其分压后得到输入和输出电阻的值。</p>
<p><img src="/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220711195608205.png" alt="输入电阻测量" style="zoom:50%;"></p>
<p><img src="/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220711195654269.png" alt="输出电阻测量电路" style="zoom:50%;"></p>
<p>可将上述电路简化为：</p>
<p><img src="/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220711200131566.png" alt="输入电阻模型"></p>
<p>那么其输入电阻为：</p>
<script type="math/tex; mode=display">
R_i=\frac{U_i}{I_i}=\frac{U_i}{\frac{U_s-U_i}{R} }=\frac{U_i}{U_s-U_i}R</script><p>同理，输出电阻的测量模型可被简化，放大电路的输出端可看成有源二端网络。：</p>
<p><img src="/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220711200650035.png" alt="输出电阻测量模型" style="zoom:50%;"></p>
<p>那么其输出电阻为：</p>
<script type="math/tex; mode=display">
R_i=\frac{U_0'-U_0}{\frac{U_0}{R_L}}=(\frac{U_0'}{U_0}-1)R_L</script><p>同样，我们可以在其无负载工作时，在其输入和输出端口进行电压的采样，同时通过DDS进行扫频信号的发生来获得其幅频特性。</p>
<h3 id="2-2-信号发生和衰减"><a href="#2-2-信号发生和衰减" class="headerlink" title="2.2  信号发生和衰减"></a>2.2  信号发生和衰减</h3><p>本次我们采用DDS进行信号的发生，原因在于DDS方便给出幅度和频率较为容易固定的稳定正弦信号。本次使用的模块为康威科技的AD9834模块，根据其原理图，我们容易发现该DDS模块使用SMA输出，同时也添加了LC滤波器。而本次扫频需要用到的1000Hz到200kHz以上均处于该模块滤波器的通频带上，同时SMA和滤波器的组合也让该DDS的信号噪音较少。</p>
<p>综上，本题目中我们采用的DDS能够给出较为稳定的<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.65ex;" xmlns="http://www.w3.org/2000/svg" width="3.116ex" height="2.195ex" role="img" focusable="false" viewbox="0 -683 1377.3 970.2"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D449" d="M52 648Q52 670 65 683H76Q118 680 181 680Q299 680 320 683H330Q336 677 336 674T334 656Q329 641 325 637H304Q282 635 274 635Q245 630 242 620Q242 618 271 369T301 118L374 235Q447 352 520 471T595 594Q599 601 599 609Q599 633 555 637Q537 637 537 648Q537 649 539 661Q542 675 545 679T558 683Q560 683 570 683T604 682T668 681Q737 681 755 683H762Q769 676 769 672Q769 655 760 640Q757 637 743 637Q730 636 719 635T698 630T682 623T670 615T660 608T652 599T645 592L452 282Q272 -9 266 -16Q263 -18 259 -21L241 -22H234Q216 -22 216 -15Q213 -9 177 305Q139 623 138 626Q133 637 76 637H59Q52 642 52 648Z"/></g><g data-mml-node="TeXAtom" transform="translate(616,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g><g data-mml-node="mi" transform="translate(503,0)"><path data-c="1D45D" d="M23 287Q24 290 25 295T30 317T40 348T55 381T75 411T101 433T134 442Q209 442 230 378L240 387Q302 442 358 442Q423 442 460 395T497 281Q497 173 421 82T249 -10Q227 -10 210 -4Q199 1 187 11T168 28L161 36Q160 35 139 -51T118 -138Q118 -144 126 -145T163 -148H188Q194 -155 194 -157T191 -175Q188 -187 185 -190T172 -194Q170 -194 161 -194T127 -193T65 -192Q-5 -192 -24 -194H-32Q-39 -187 -39 -183Q-37 -156 -26 -148H-6Q28 -147 33 -136Q36 -130 94 103T155 350Q156 355 156 364Q156 405 131 405Q109 405 94 377T71 316T59 280Q57 278 43 278H29Q23 284 23 287ZM178 102Q200 26 252 26Q282 26 310 49T356 107Q374 141 392 215T411 325V331Q411 405 350 405Q339 405 328 402T306 393T286 380T269 365T254 350T243 336T235 326L232 322Q232 321 229 308T218 264T204 212Q178 106 178 102Z"/></g></g></g></g></g></svg></mjx-container> 为</p>
<p><img src="/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220711202233299.png" alt="AD9834模块原理图" style="zoom:50%;"></p>
<p>由于该放大器在搭建时，其静态工作点已经被选定，所以在该选定静态工作点时，我们寻找一个较为合适的输入电压来获得一个能有较好测量结果的输出电压——由于在进行故障分析时，其输出电压可能为12V，而本次采用的ADC的电压测量上限为3.3V，所以其输出必须被衰减。这里我们选择衰减了4倍，也就是说，在该电路进行放大被衰减后，我们仍然需要一个能由STM32片上ADC准确测得的电压值。</p>
<p>在这里，我们通过模拟仿真得到放大结果后进行分析汇总，发现在输入为20mV时，在常见的扫频频率下，其放大的交流电压幅值能到2-2.5V左右，同时直流成分在7V左右，即使经过4倍衰减也能够较好地被ADC分辨。</p>
<p><strong>综上所述，</strong>我们使用运算放大器NE5532实现衰减器的搭建。该运算放大器<em>**</em>是高性能低噪声双运算放大器（双运放）集成电路。与很多标准运放相似，但它具有更好的噪声性能，优良的输出驱动能力 及相当高的小信号带宽，电源电压范围大等特点。因此很适合应用在高品质和专业音响设备、仪器、控制电路及电话通道放大器。</p>
<p><img src="/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/0dd7912397dda14436109687b0b7d0a20cf486ee.jpg" alt="NE5532衰减器" style="zoom:33%;"></p>
<h3 id="2-3-测量电路模块"><a href="#2-3-测量电路模块" class="headerlink" title="2.3  测量电路模块"></a>2.3  测量电路模块</h3><p>在前一节已经展示过结构。</p>
<ol>
<li>使用继电器让采样电阻与输入串联来获得输入电阻。</li>
<li>使用几点爱让采样电阻与输出并联来获得输出电阻。</li>
</ol>
<h3 id="2-4-处理器模块"><a href="#2-4-处理器模块" class="headerlink" title="2.4  处理器模块"></a>2.4  处理器模块</h3><p>由于本次使用的MCU仅有2个ADC外设，同时由于判断发展指标需要用到同步采样，在2个ADC同时被设置为同步模式时，使用定时器触发仅能使用1通道来保证2个ADC采样的实时性，故使用继电器与待测电路连接来获得采样电阻两端电压，同时不影响获取无负载电压。结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">graph LR;</span><br><span class="line">    MCU[STM32H7B0]--&gt;A1[ADC1]--继电器1状态1--&gt;In[输入采样电路左端]</span><br><span class="line">    A1--继电器1状态2--&gt;In2[采样电阻右端]</span><br><span class="line">    MCU--&gt;A2[ADC2]--继电器2状态1--&gt;输出采样电路正极---C(由于输出采样电阻接地,无须其他继电器)</span><br><span class="line">    A2--继电器2状态2--&gt;无负载输出电路</span><br><span class="line">    In---B(此端可由继电器3控制作为采样或者无负载)</span><br></pre></td></tr></table></figure>
<h2 id="三、电路与程序设计"><a href="#三、电路与程序设计" class="headerlink" title="三、电路与程序设计"></a>三、电路与程序设计</h2><h3 id="3-1-电路设计"><a href="#3-1-电路设计" class="headerlink" title="3.1 电路设计"></a>3.1 电路设计</h3><h4 id="1-待测电路设计"><a href="#1-待测电路设计" class="headerlink" title="(1)  待测电路设计"></a>(1)  待测电路设计</h4><p>本次电路设计主要为在原有电路的基础上添加继电器让ADC的采样点、采样电阻的接入状态发生变化，总体简化仿真框图如下，详细说明见图下方：</p>
<p><img src="/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220711212641617.png" alt="电路设计" style="zoom:50%;"></p>
<p>说明：</p>
<ol>
<li>在本电路设计中，主体部分为题目中给出的待测电路加上R5,R6两个采样电阻。</li>
<li>所有既有电容电阻前的开关为仿真发展指标时使用，在实际电路中被接线端子代替。</li>
<li>使用的继电器为S8和被探针3遮挡的S6。</li>
<li>中控制ADC1采集输入电阻两端的继电器被省略。</li>
<li>信号发生器为DDS电路与信号衰减器的结合。其中，衰减器结构见上文。</li>
</ol>
<h3 id="3-2-程序设计"><a href="#3-2-程序设计" class="headerlink" title="3.2 程序设计"></a>3.2 程序设计</h3><h4 id="1-程序主体设计"><a href="#1-程序主体设计" class="headerlink" title="(1) 程序主体设计"></a>(1) 程序主体设计</h4><p>本程序的主体设计为线性设计，使用<code>Global_Status</code>进结构体状态机对于系统运行状态在有整体校验没有异常后，对于标准指标进行测试；在校验出现异常时进行发展指标的测试，即检查电路问题。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">{</span><br><span class="line">  Circuit_Init(); <span class="comment">//对于电路整体初始化，继电器位置默认电路正常运行状态</span></span><br><span class="line">  <span class="keyword">if</span> (!Global_Status.error_detect)<span class="comment">//首先对系统状态机进行判断，如果出现问题自动开始修复问题</span></span><br><span class="line">  {</span><br><span class="line">    Global_Status.Ri = GetRi(); <span class="comment">//获得输入电阻的值</span></span><br><span class="line">    Global_Status.Ro = GetRo(); <span class="comment">//获得输出电阻的值</span></span><br><span class="line">    Global_Status.Au = GetAu(); <span class="comment">//获取增益并且输出，同时承担了测量直流和交流的工作</span></span><br><span class="line">    Scan_HZ(&amp;Global_Status.L_hz, &amp;Global_Status.H_hz);  <span class="comment">//扫频获得截止频率</span></span><br><span class="line">  }</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  {</span><br><span class="line">    Global_Status.error = Detect_Error(); <span class="comment">//进行错误检测，即进行发展指标发现的尝试。</span></span><br><span class="line">  }</span><br><span class="line">  GUI_Out();  <span class="comment">//在串口屏上打印数据</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<p>流程图如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">graph TD;</span><br><span class="line">    Start(开始)--&gt;进行电路初始化--&gt;Check{{对全局结构体中,电路状态值进行校验}}--正常&lt;/br&gt;改变继电器位置--&gt;F0</span><br><span class="line">    Check--非正常--&gt;Error_Check;</span><br><span class="line">    subgraph Sub1[顺序检测模块];</span><br><span class="line">        F0[求输入和输出电阻]--改变继电器位置&lt;/br&gt;让电路恢复正常--&gt;F1[求有效值和扫频]</span><br><span class="line">        Exp(凡是在本部分&lt;/br&gt;检查出现错误的值&lt;/br&gt;,向全局结构体中&lt;/br&gt;电路状态值添加)</span><br><span class="line">    end</span><br><span class="line"></span><br><span class="line">    subgraph Sub2[异常诊断模块]</span><br><span class="line">        Error_Check[对于以上&lt;/br&gt;采集到的&lt;/br&gt;异常数据&lt;/br&gt;进行分析]--&gt;Err_rslt[并且添加在&lt;/br&gt;状态结构体中]</span><br><span class="line">    end</span><br><span class="line">    END_LOOP(结束循环并打印到串口屏);</span><br><span class="line">    F1--&gt;END_LOOP;Err_rslt--&gt;END_LOOP--&gt;C(进行下一轮校验)</span><br></pre></td></tr></table></figure>
<p>其中，使用的全局状态结构体提供绝大多数的错误判定，以及起最后的结果输出作用：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//全局状态结构体</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span>{</span></span><br><span class="line">    <span class="type">uint8_t</span> ADC_OK;<span class="comment">//ADC数据准备完成标志</span></span><br><span class="line">    <span class="type">uint8_t</span> FirstChange;<span class="comment">//电路结构改变标志</span></span><br><span class="line">    <span class="type">uint8_t</span> error_detect;<span class="comment">//是否开启故障检查标志</span></span><br><span class="line"></span><br><span class="line">    <span class="type">float32_t</span> Ri;<span class="comment">//输入电阻</span></span><br><span class="line">    <span class="type">float32_t</span> Ro;<span class="comment">//输出电阻</span></span><br><span class="line">    <span class="type">float32_t</span> Au;<span class="comment">//增益-中频</span></span><br><span class="line">    <span class="type">float32_t</span> H_hz;<span class="comment">//上限截止频率</span></span><br><span class="line">    <span class="type">float32_t</span> L_hz;<span class="comment">//下限截止频率</span></span><br><span class="line"></span><br><span class="line">    <span class="type">float32_t</span> DC_out;<span class="comment">//输出直流</span></span><br><span class="line">    <span class="type">float32_t</span> AC_out;<span class="comment">//输出交流</span></span><br><span class="line"></span><br><span class="line">    ErrorType error;<span class="comment">//电路故障状态</span></span><br><span class="line">    CircuitMode Mode;<span class="comment">//电路状态</span></span><br><span class="line">}Status;    </span><br><span class="line"></span><br><span class="line"><span class="comment">//异常状态结构体</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">enum</span> {</span></span><br><span class="line">    NO_EEROR=<span class="number">0</span>,<span class="comment">//正常</span></span><br><span class="line">    R1_BR,<span class="comment">//R1断路</span></span><br><span class="line">    R2_BR,<span class="comment">//R2断路</span></span><br><span class="line">    R3_BR,<span class="comment">//R3断路</span></span><br><span class="line">    R4_BR,<span class="comment">//R4断路</span></span><br><span class="line">    R1_SH,<span class="comment">//R1短路</span></span><br><span class="line">    R2_SH,<span class="comment">//R2短路</span></span><br><span class="line">    R3_SH,<span class="comment">//R3短路</span></span><br><span class="line">    R4_SH,<span class="comment">//R4短路</span></span><br><span class="line">    C1_BR,<span class="comment">//C1断路</span></span><br><span class="line">    C2_BR,<span class="comment">//C2断路</span></span><br><span class="line">    C3_BR,<span class="comment">//C3断路</span></span><br><span class="line">    C1_ADD,<span class="comment">//C1增加</span></span><br><span class="line">    C2_ADD,<span class="comment">//C2增加</span></span><br><span class="line">    C3_ADD,<span class="comment">//C3增加</span></span><br><span class="line">}ErrorType;</span><br></pre></td></tr></table></figure>
<h4 id="2-FFT采样设计"><a href="#2-FFT采样设计" class="headerlink" title="(2)  FFT采样设计"></a>(2)  FFT采样设计</h4><p>我们在本题借助FFT求取其幅频特性，分离直流。使用ARM的DSP库进行32位浮点数的FFT运算。</p>
<p>对于ADC采样数据的转换、之后使用ARM_FFT运算，代码如下，逻辑简单，其中调用函数顺序为<code>GetMagFromADC-&gt;Myfft_mag-&gt;arm_cfft_f32_app</code>逻辑简单，故不再赘述：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*************************************************************</span></span><br><span class="line"><span class="comment">* 从ADC获取电压幅值</span></span><br><span class="line"><span class="comment">* Adc1Va：储存ADC1的结果，Adc2Va：储存ADC2的结果</span></span><br><span class="line"><span class="comment">* return：NONE</span></span><br><span class="line"><span class="comment">*************************************************************</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">static</span> <span class="type">void</span> <span class="title function_">GetMagFromADC</span><span class="params">(FFT_Result *Adc1Va,FFT_Result *Adc2Va)</span></span><br><span class="line">{</span><br><span class="line">    <span class="keyword">while</span>(!Global_Status.ADC_OK){};<span class="comment">//等待ADC转化完毕</span></span><br><span class="line">    Global_Status.ADC_OK=<span class="number">0</span>;<span class="comment">//清除ADC标志</span></span><br><span class="line"></span><br><span class="line">    <span class="type">uint16_t</span> ADC1_Values[<span class="number">1024</span>];</span><br><span class="line">    <span class="type">uint16_t</span> ADC2_Values[<span class="number">1024</span>];</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint16_t</span> i = <span class="number">0</span>;i &lt; <span class="number">1024</span>;i++) </span><br><span class="line">    {</span><br><span class="line">    ADC2_Values[i] = (<span class="type">uint16_t</span>)((ADC_Double_Values[i] &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xffff</span>);<span class="comment">//高16位保存ADC2</span></span><br><span class="line">    ADC1_Values[i] = (<span class="type">uint16_t</span>)(ADC_Double_Values[i] &amp; <span class="number">0xffff</span>);<span class="comment">//低16位保存ADC1</span></span><br><span class="line">    }</span><br><span class="line">    Myfft_mag(ADC1_Values,Order,Adc1Va);</span><br><span class="line">    Myfft_mag(ADC2_Values,Order,Adc2Va);</span><br><span class="line">    ADC_Start();</span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*FFT运算函数,得到特定频率模值</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">*ADC_In：ADC数据数组,大小1024</span></span><br><span class="line"><span class="comment">*FFT_Result:FFT运算结果结构体</span></span><br><span class="line"><span class="comment">*Order:信号在频谱中的位置</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">Myfft_mag</span><span class="params">(<span class="type">uint16_t</span> ADC_In[], <span class="type">uint16_t</span> Order, FFT_Result* FFT_Result)</span></span><br><span class="line">{</span><br><span class="line">    arm_cfft_f32_app(ADC_In, _FFT_Out);    <span class="comment">//fft的apply，对于传入的uint16数组再次进行规划转换为float32_t数组之后使用arm_fft进行处理</span></span><br><span class="line"></span><br><span class="line">    arm_cmplx_mag_f32(_FFT_Out, _FFT_Magout, <span class="number">1024</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>;i &lt; <span class="number">1024</span>;i++)<span class="comment">//对数据进行归一化处理，直流分量除以N，其他除N/2,未去半</span></span><br><span class="line">    {</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>) _FFT_Magout[i] = _FFT_Magout[i] / <span class="number">1024</span>;</span><br><span class="line">        <span class="keyword">else</span> _FFT_Magout[i] = _FFT_Magout[i] / (<span class="number">1024</span> / <span class="number">2</span>);</span><br><span class="line">    }</span><br><span class="line">    FFT_Result-&gt;DC_Raw = _FFT_Magout[<span class="number">0</span>];FFT_Result-&gt;DC = (_FFT_Magout[<span class="number">0</span>] * REF_V);<span class="comment">//直流</span></span><br><span class="line">    FFT_Result-&gt;AC_Raw = _FFT_Magout[Order];FFT_Result-&gt;AC = (_FFT_Magout[Order] * REF_V);<span class="comment">//交流</span></span><br><span class="line">    arm_sqrt_f32((<span class="type">float32_t</span>)(((FFT_Result-&gt;AC) * (FFT_Result-&gt;AC) / <span class="number">2</span>) + (FFT_Result-&gt;DC) * (FFT_Result-&gt;DC)), &amp;(FFT_Result-&gt;Real));<span class="comment">//有效值</span></span><br><span class="line">}</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * @brief 求解FFT结果的蟹函数</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * @param _in 输入数组，长度为1024位</span></span><br><span class="line"><span class="comment"> * @param testInput_f32 输入的最后得到结果的存储数组，2048位</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">arm_cfft_f32_app</span><span class="params">(<span class="type">uint16_t</span>* _in, <span class="type">float32_t</span>* testInput_f32)</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">uint8_t</span> ifftFlag = <span class="number">0</span>;</span><br><span class="line">    <span class="type">uint8_t</span> doBitReverse = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//static uint16_t TEST_LENGTH_SAMPLES = MID;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 按照实部，虚部，实部，虚部..... 的顺序存储数据 */</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint16_t</span> i = <span class="number">0</span>; i &lt; <span class="number">1024</span>; i++)</span><br><span class="line">    {</span><br><span class="line">        <span class="comment">/* 波形是由直流分量，50Hz正弦波组成，波形采样率1024，初始相位60° */</span></span><br><span class="line">        testInput_f32[i * <span class="number">2</span>] = (<span class="type">float32_t</span>)_in[i];</span><br><span class="line">        testInput_f32[i * <span class="number">2</span> + <span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">    }</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* CFFT变换 */</span></span><br><span class="line">    arm_cfft_f32(&amp;arm_cfft_sR_f32_len1024, testInput_f32, ifftFlag, doBitReverse);</span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="3-输入电阻测量设计"><a href="#3-输入电阻测量设计" class="headerlink" title="(3)  输入电阻测量设计"></a>(3)  输入电阻测量设计</h4><p>由上文提及公式：<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -1.89ex;" xmlns="http://www.w3.org/2000/svg" width="26.682ex" height="4.005ex" role="img" focusable="false" viewbox="0 -934.5 11793.3 1770.1"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="TeXAtom" data-mjx-texclass="ORD"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"/></g><g data-mml-node="mi" transform="translate(792,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g><g data-mml-node="mo" transform="translate(1363.7,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mfrac" transform="translate(2419.5,0)"><g data-mml-node="msub" transform="translate(220,451.6) scale(0.707)"><g data-mml-node="mi"><path data-c="1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></g><g data-mml-node="mi" transform="translate(716,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g><g data-mml-node="msub" transform="translate(305.9,-345) scale(0.707)"><g data-mml-node="mi"><path data-c="1D43C" d="M43 1Q26 1 26 10Q26 12 29 24Q34 43 39 45Q42 46 54 46H60Q120 46 136 53Q137 53 138 54Q143 56 149 77T198 273Q210 318 216 344Q286 624 286 626Q284 630 284 631Q274 637 213 637H193Q184 643 189 662Q193 677 195 680T209 683H213Q285 681 359 681Q481 681 487 683H497Q504 676 504 672T501 655T494 639Q491 637 471 637Q440 637 407 634Q393 631 388 623Q381 609 337 432Q326 385 315 341Q245 65 245 59Q245 52 255 50T307 46H339Q345 38 345 37T342 19Q338 6 332 0H316Q279 2 179 2Q143 2 113 2T65 2T43 1Z"/></g><g data-mml-node="mi" transform="translate(473,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g><rect width="914.1" height="60" x="120" y="220"/></g><g data-mml-node="mo" transform="translate(3851.4,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mfrac" transform="translate(4907.2,0)"><g data-mml-node="msub" transform="translate(799.5,451.6) scale(0.707)"><g data-mml-node="mi"><path data-c="1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></g><g data-mml-node="mi" transform="translate(716,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g><g data-mml-node="mfrac" transform="translate(220,-581.1) scale(0.707)"><g data-mml-node="mrow" transform="translate(220,565.1) scale(0.707)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></g><g data-mml-node="mi" transform="translate(716,-150)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"/></g></g><g data-mml-node="mo" transform="translate(1235,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="msub" transform="translate(2013,0)"><g data-mml-node="mi"><path data-c="1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></g><g data-mml-node="mi" transform="translate(716,-307.4)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g></g><g data-mml-node="mi" transform="translate(1056.2,-345) scale(0.707)"><path data-c="1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"/></g><rect width="2409" height="60" x="120" y="220"/></g><rect width="2073.1" height="60" x="120" y="220"/></g><g data-mml-node="mo" transform="translate(7498.1,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"/></g><g data-mml-node="mfrac" transform="translate(8553.9,0)"><g data-mml-node="msub" transform="translate(883.1,451.6) scale(0.707)"><g data-mml-node="mi"><path data-c="1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></g><g data-mml-node="mi" transform="translate(716,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g><g data-mml-node="mrow" transform="translate(220,-345) scale(0.707)"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></g><g data-mml-node="mi" transform="translate(716,-150) scale(0.707)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"/></g></g><g data-mml-node="mo" transform="translate(1097.6,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"/></g><g data-mml-node="msub" transform="translate(1875.6,0)"><g data-mml-node="mi"><path data-c="1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></g><g data-mml-node="mi" transform="translate(716,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g></g><rect width="2240.4" height="60" x="120" y="220"/></g><g data-mml-node="mi" transform="translate(11034.3,0)"><path data-c="1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"/></g></g></g></g></svg></mjx-container>可知，使用双电压法求得输出电阻需要经过如下几个步骤：</p>
<ol>
<li><p>电路为初始状态值时，求得无负载时的输入电压：<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.355ex;" xmlns="http://www.w3.org/2000/svg" width="2.483ex" height="1.901ex" role="img" focusable="false" viewbox="0 -683 1097.6 840.1"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></g><g data-mml-node="mi" transform="translate(716,-150) scale(0.707)"><path data-c="1D460" d="M131 289Q131 321 147 354T203 415T300 442Q362 442 390 415T419 355Q419 323 402 308T364 292Q351 292 340 300T328 326Q328 342 337 354T354 372T367 378Q368 378 368 379Q368 382 361 388T336 399T297 405Q249 405 227 379T204 326Q204 301 223 291T278 274T330 259Q396 230 396 163Q396 135 385 107T352 51T289 7T195 -10Q118 -10 86 19T53 87Q53 126 74 143T118 160Q133 160 146 151T160 120Q160 94 142 76T111 58Q109 57 108 57T107 55Q108 52 115 47T146 34T201 27Q237 27 263 38T301 66T318 97T323 122Q323 150 302 164T254 181T195 196T148 231Q131 256 131 289Z"/></g></g></g></g></svg></mjx-container></p>
</li>
<li><p>将待测电阻接入电路，求得采样电阻<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.048ex;" xmlns="http://www.w3.org/2000/svg" width="1.717ex" height="1.593ex" role="img" focusable="false" viewbox="0 -683 759 704"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><path data-c="1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"/></g></g></g></svg></mjx-container>两端的电压差<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="2.285ex" height="1.902ex" role="img" focusable="false" viewbox="0 -683 1010 840.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></g><g data-mml-node="mi" transform="translate(716,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g></g></g></svg></mjx-container></p>
<blockquote>
<p>这里由于我们并未使用2路ADC对于对于采样电阻两端的电压进行直接采集，而是使用电位器，分2次采集该电阻两端的电压</p>
</blockquote>
</li>
<li><p>其中，输入和电压差都为电压有效值: ,由于这里是正弦信号，我们可以将这个值化简为：${U=\sqrt{U<em>{DC}^2+\frac{U</em>{AC}^2}{2}}}$</p>
</li>
<li><p>至此，我们可以根据如上逻辑写出对应的<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.357ex;" xmlns="http://www.w3.org/2000/svg" width="2.457ex" height="1.902ex" role="img" focusable="false" viewbox="0 -683 1086 840.8"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"/></g><g data-mml-node="mi" transform="translate(792,-150) scale(0.707)"><path data-c="1D456" d="M184 600Q184 624 203 642T247 661Q265 661 277 649T290 619Q290 596 270 577T226 557Q211 557 198 567T184 600ZM21 287Q21 295 30 318T54 369T98 420T158 442Q197 442 223 419T250 357Q250 340 236 301T196 196T154 83Q149 61 149 51Q149 26 166 26Q175 26 185 29T208 43T235 78T260 137Q263 149 265 151T282 153Q302 153 302 143Q302 135 293 112T268 61T223 11T161 -11Q129 -11 102 10T74 74Q74 91 79 106T122 220Q160 321 166 341T173 380Q173 404 156 404H154Q124 404 99 371T61 287Q60 286 59 284T58 281T56 279T53 278T49 278T41 278H27Q21 284 21 287Z"/></g></g></g></g></svg></mjx-container>的对应程序。</p>
</li>
</ol>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float32_t</span> <span class="title function_">GetRi</span><span class="params">(<span class="type">void</span>)</span><span class="comment">//获取输入电阻</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">float32_t</span> Ri = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//由于只有两个ADC,使用ADC1测输出，使用ADC2测输入</span></span><br><span class="line">    <span class="comment">//ADC2先通过短路采样电阻测DDS的输出，然后接入采样电阻测右端电压</span></span><br><span class="line">    <span class="comment">/*先测Rs左端电压*/</span></span><br><span class="line">    FFT_Result L_values = { <span class="number">0</span> };</span><br><span class="line">    ChangeCircuit(MODE_NORMAL);<span class="comment">//短路采样电阻</span></span><br><span class="line">    GetMagFromADC2(&amp;L_values);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/*再测Rs右端电压*/</span></span><br><span class="line">    FFT_Result R_values = { <span class="number">0</span> };</span><br><span class="line">    ChangeCircuit(HAVE_INPUT);<span class="comment">//接入采样电阻</span></span><br><span class="line">    GetMagFromADC2(&amp;R_values);</span><br><span class="line"></span><br><span class="line">    Ri = R_values.Real * INPUT_R / (L_values.Real - R_values.Real);<span class="comment">//不需要乘增益</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Ri;    <span class="comment">//返回值为输入电阻值</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="4-输出电阻测量设计"><a href="#4-输出电阻测量设计" class="headerlink" title="(4)  输出电阻测量设计"></a>(4)  输出电阻测量设计</h4><p>由公式：</p>
<script type="math/tex; mode=display">
R_i=\frac{U_0'-U_0}{\frac{U_0}{R_L}}=(\frac{U_0'}{U_0}-1)R_L</script><p>可知，我们需要在电路空载的情况下，先求得空负载时的输出电压<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.375ex;" xmlns="http://www.w3.org/2000/svg" width="2.533ex" height="1.92ex" role="img" focusable="false" viewbox="0 -683 1119.6 848.6"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></g><g data-mml-node="mn" transform="translate(716,-150) scale(0.707)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g></g></g></g></svg></mjx-container> ，再将<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.339ex;" xmlns="http://www.w3.org/2000/svg" width="2.994ex" height="1.885ex" role="img" focusable="false" viewbox="0 -683 1323.5 833"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D445" d="M230 637Q203 637 198 638T193 649Q193 676 204 682Q206 683 378 683Q550 682 564 680Q620 672 658 652T712 606T733 563T739 529Q739 484 710 445T643 385T576 351T538 338L545 333Q612 295 612 223Q612 212 607 162T602 80V71Q602 53 603 43T614 25T640 16Q668 16 686 38T712 85Q717 99 720 102T735 105Q755 105 755 93Q755 75 731 36Q693 -21 641 -21H632Q571 -21 531 4T487 82Q487 109 502 166T517 239Q517 290 474 313Q459 320 449 321T378 323H309L277 193Q244 61 244 59Q244 55 245 54T252 50T269 48T302 46H333Q339 38 339 37T336 19Q332 6 326 0H311Q275 2 180 2Q146 2 117 2T71 2T50 1Q33 1 33 10Q33 12 36 24Q41 43 46 45Q50 46 61 46H67Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628Q287 635 230 637ZM630 554Q630 586 609 608T523 636Q521 636 500 636T462 637H440Q393 637 386 627Q385 624 352 494T319 361Q319 360 388 360Q466 361 492 367Q556 377 592 426Q608 449 619 486T630 554Z"/></g><g data-mml-node="mi" transform="translate(792,-150) scale(0.707)"><path data-c="1D43F" d="M228 637Q194 637 192 641Q191 643 191 649Q191 673 202 682Q204 683 217 683Q271 680 344 680Q485 680 506 683H518Q524 677 524 674T522 656Q517 641 513 637H475Q406 636 394 628Q387 624 380 600T313 336Q297 271 279 198T252 88L243 52Q243 48 252 48T311 46H328Q360 46 379 47T428 54T478 72T522 106T564 161Q580 191 594 228T611 270Q616 273 628 273H641Q647 264 647 262T627 203T583 83T557 9Q555 4 553 3T537 0T494 -1Q483 -1 418 -1T294 0H116Q32 0 32 10Q32 17 34 24Q39 43 44 45Q48 46 59 46H65Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Q285 635 228 637Z"/></g></g></g></g></svg></mjx-container> 串入，测得<mjx-container class="MathJax" jax="SVG"><svg style="vertical-align: -0.618ex;" xmlns="http://www.w3.org/2000/svg" width="2.533ex" height="2.335ex" role="img" focusable="false" viewbox="0 -759 1119.6 1032.1"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msubsup"><g data-mml-node="mi"><path data-c="1D448" d="M107 637Q73 637 71 641Q70 643 70 649Q70 673 81 682Q83 683 98 683Q139 681 234 681Q268 681 297 681T342 682T362 682Q378 682 378 672Q378 670 376 658Q371 641 366 638H364Q362 638 359 638T352 638T343 637T334 637Q295 636 284 634T266 623Q265 621 238 518T184 302T154 169Q152 155 152 140Q152 86 183 55T269 24Q336 24 403 69T501 205L552 406Q599 598 599 606Q599 633 535 637Q511 637 511 648Q511 650 513 660Q517 676 519 679T529 683Q532 683 561 682T645 680Q696 680 723 681T752 682Q767 682 767 672Q767 650 759 642Q756 637 737 637Q666 633 648 597Q646 592 598 404Q557 235 548 205Q515 105 433 42T263 -22Q171 -22 116 34T60 167V183Q60 201 115 421Q164 622 164 628Q164 635 107 637Z"/></g><g data-mml-node="mo" transform="translate(854.2,363) scale(0.707)"><path data-c="2032" d="M79 43Q73 43 52 49T30 61Q30 68 85 293T146 528Q161 560 198 560Q218 560 240 545T262 501Q262 496 260 486Q259 479 173 263T84 45T79 43Z"/></g><g data-mml-node="mn" transform="translate(716,-257.5) scale(0.707)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"/></g></g></g></g></svg></mjx-container> 。之后套入公式，对应程序如下。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float32_t</span> <span class="title function_">GetRo</span><span class="params">(<span class="type">void</span>)</span><span class="comment">//获取输出电阻</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">float32_t</span> Ro = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//使用ADC1测输出电阻</span></span><br><span class="line">    <span class="comment">/*先测空载*/</span></span><br><span class="line">    FFT_Result L_values = { <span class="number">0</span> };</span><br><span class="line">    ChangeCircuit(MODE_NORMAL);</span><br><span class="line">    GetMagFromADC1(&amp;L_values);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/*再测负载*/</span></span><br><span class="line">    FFT_Result R_values = { <span class="number">0</span> };</span><br><span class="line">    ChangeCircuit(HAVE_OUTPUT);</span><br><span class="line">    GetMagFromADC1(&amp;R_values);</span><br><span class="line"></span><br><span class="line">    Ro = (L_values.Real / R_values.Real - <span class="number">1</span>) * OUTPUT_R;<span class="comment">//不需要乘增益</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Ro;    <span class="comment">//返回值为输出电阻值</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="5-求解增益程序设计"><a href="#5-求解增益程序设计" class="headerlink" title="(5)  求解增益程序设计"></a>(5)  求解增益程序设计</h4><p>在设计求增益程序的过程当中，我们将电路恢复至正常状态之后，进行测量，具体的测量步骤已经在代码注释中体现，不再赘述。在求增益的过程当中，我们充分利用了上述FFT程序模块当中提供的接口，做到了简洁和清洗。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">float32_t</span> <span class="title function_">GetAu</span><span class="params">(<span class="type">void</span>)</span><span class="comment">//获得增益</span></span><br><span class="line">{</span><br><span class="line">    <span class="type">float32_t</span> Au = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//使用ADC1测输出，使用ADC2测输入</span></span><br><span class="line">    <span class="comment">//增益的计算公式Au=20lg(Uo/ui)</span></span><br><span class="line">    FFT_Result IN_values = { <span class="number">0</span> }, OUT_values = { <span class="number">0</span> };</span><br><span class="line">    ChangeCircuit(MODE_NORMAL);</span><br><span class="line">    GetMagFromADC(&amp;OUT_values, &amp;IN_values);</span><br><span class="line"></span><br><span class="line">    Au = OUT_values.AC / IN_values.AC;<span class="comment">//通过对于交流直接相除得到增益</span></span><br><span class="line"></span><br><span class="line">    Global_Status.AC_out = OUT_values.AC * OUTPUT_GAIN;<span class="comment">//幅度</span></span><br><span class="line">    Global_Status.DC_out = OUT_values.DC * OUTPUT_GAIN;<span class="comment">//直流</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> Au;    <span class="comment">//返回值为得到的增益值</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="5-扫频模块程序设计"><a href="#5-扫频模块程序设计" class="headerlink" title="(5)   扫频模块程序设计"></a>(5)   扫频模块程序设计</h4><p>在扫频模块当中，由于我们在本题借助FFT求取其幅频特性，分离直流，在进行扫频的过程当中，需要对于采样速率有着较为阉割的限制，因此我们的代码需要对于基波频率和采样频率都进行设置，通过定时器触发让ADC的采样间隔较为稳定，从而便于我们在频谱中找到我们需要的模值和直流。代码展示设置定时器部分。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">graph TD</span><br><span class="line">    Head(&lt;strong&gt;传入数据:&lt;/br&gt;待扫频率,总采样点数,设置触发的定时器)--&gt;AUTO0[&lt;strong&gt;设置DDS频率,计算采样频率&lt;/strong&gt;&lt;/br&gt;在低频时采样倍率更高&lt;/br&gt;高频时更高]--&gt;AUTO1[&lt;strong&gt;进行采样率与定时器定时时间的转化&lt;/strong&gt;&lt;/br&gt;将采样率转化为时间后与系统主频进行&lt;/br&gt;公约数运算之后设置定时器]</span><br><span class="line">    AUTO1--&gt;END(将最终该频率&lt;strong&gt;在频谱上的位置&lt;/&gt;返回)</span><br></pre></td></tr></table></figure>
<p>进行定时器时间转化的代码：</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//配合AutoSetTim使用的修改计时器的函数</span></span><br><span class="line"><span class="type">static</span> <span class="type">uint16_t</span> <span class="title function_">CalARRBySamplingRate</span><span class="params">(<span class="type">uint32_t</span> SamplingRate, TIM_HandleTypeDef* htim)</span> {</span><br><span class="line">    <span class="type">uint32_t</span> totalDashed = RCC_Rate / (<span class="type">float</span>)SamplingRate;  <span class="comment">//求出填入定时器中的主时钟总周期数量</span></span><br><span class="line"></span><br><span class="line">    <span class="type">uint16_t</span> Period;    <span class="comment">//定时器间隔 </span></span><br><span class="line">    <span class="type">uint16_t</span> step = <span class="number">1</span>;  <span class="comment">//循环运算步长</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">uint32_t</span> Prescaler<span class="comment">/*预分频*/</span> = <span class="number">2</span>;Prescaler &lt; totalDashed / <span class="number">2</span> || Prescaler &lt; <span class="number">0xffff</span>; Prescaler += step) {</span><br><span class="line">        <span class="comment">//从小到大寻找n的因数</span></span><br><span class="line">        <span class="keyword">while</span> (totalDashed % Prescaler == <span class="number">0</span>)   <span class="comment">//当n%j（因数）== 0时，继续分解</span></span><br><span class="line">        {</span><br><span class="line">            step = Prescaler;   <span class="comment">//如果能除余，下一次加上分频的步长</span></span><br><span class="line">            <span class="keyword">if</span> (totalDashed / Prescaler &lt;= <span class="number">0xffff</span>   <span class="comment">/*周期的值进行预判断*/</span>) {</span><br><span class="line">                Period = totalDashed / Prescaler;</span><br><span class="line">                __HAL_TIM_SET_PRESCALER(htim, Period - <span class="number">1</span>);  <span class="comment">//设置定时区间</span></span><br><span class="line">                __HAL_TIM_SetAutoreload(htim, Prescaler - <span class="number">1</span>);   <span class="comment">//设置预分频</span></span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span>;   <span class="comment">//正常返回</span></span><br><span class="line">            }</span><br><span class="line">            <span class="keyword">else</span> {</span><br><span class="line">                <span class="keyword">break</span>;  <span class="comment">//如果不满足要求就重新运算，直到周期和预分频都小于0xffff能够放入寄存器</span></span><br><span class="line">            }</span><br><span class="line">        }</span><br><span class="line">    }</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>;   <span class="comment">//返回错误代码，重新处理</span></span><br><span class="line">}</span><br></pre></td></tr></table></figure>
<h4 id="6-发展指标测量设计"><a href="#6-发展指标测量设计" class="headerlink" title="(6)  发展指标测量设计"></a>(6)  发展指标测量设计</h4><p>通过列出结构体，结合本次题目的仿真结果，对于相应电路特性进行判定，得到最终电路出现问题的地方。</p>
<p><img src="/2022/07/16/ProgramLearn/Embed/%E6%9A%91%E5%81%87%E7%AC%AC%E4%BA%8C%E6%AC%A1%E8%AE%AD%E7%BB%83%E9%A2%98/image-20220712000025404.png" alt="仿真结果" style="zoom:80%;"></p>
<h4 id="7-显示模块程序设计"><a href="#7-显示模块程序设计" class="headerlink" title="(7)  显示模块程序设计"></a>(7)  显示模块程序设计</h4><p>通过串口屏，直接将所得结果进行串口发送后，在上位机对于字符串进行处理，画出幅频特性图，显示电路相关参数，或者显示错误原因。</p>
<h2 id="四、测试方案与测试结果"><a href="#四、测试方案与测试结果" class="headerlink" title="四、测试方案与测试结果"></a>四、测试方案与测试结果</h2><h3 id="表1-基本要求测试结果"><a href="#表1-基本要求测试结果" class="headerlink" title="表1 基本要求测试结果"></a>表1 基本要求测试结果</h3><div class="table-container">
<table>
<thead>
<tr>
<th>测量项目</th>
<th>题目指标</th>
<th>完成情况</th>
<th>是否达标</th>
<th>测试方案简述与测量仪器</th>
</tr>
</thead>
<tbody>
<tr>
<td>电路特性测试仪输出 1kHz 正弦波信号，自动测量并显示该放大器的 输入电阻。</td>
<td>输入电阻测量范围 1kΩ~50kΩ，相对误差的绝对值不超过 10%。</td>
<td></td>
<td></td>
<td>使用搭建系统自动测量。</td>
</tr>
<tr>
<td>电路特性测试仪输出 1kHz 正弦波信号，自动测量并显示该放大器的 输出电阻。</td>
<td>输出电阻测量范围 500Ω~5kΩ，相对误差的绝对值不超过 10%。</td>
<td></td>
<td></td>
<td>使用搭建系统自动测量。</td>
</tr>
<tr>
<td>自动测量并显示该放大器在输入 1kHz 频率时的增益。</td>
<td>相对误差的绝 对值不超过 10%。</td>
<td></td>
<td></td>
<td>使用搭建系统自动测量。</td>
</tr>
<tr>
<td>自动测量并显示该放大器的频幅特性曲线。</td>
<td>显示上限频率值，相对误 差的绝对值不超过 25%。</td>
<td></td>
<td></td>
<td>使用搭建系统自动测量。</td>
</tr>
</tbody>
</table>
</div>
<h3 id="表2-发挥部分测试结果"><a href="#表2-发挥部分测试结果" class="headerlink" title="表2 发挥部分测试结果"></a>表2 发挥部分测试结果</h3><div class="table-container">
<table>
<thead>
<tr>
<th>测量项目</th>
<th>题目指标</th>
<th>完成情况</th>
<th>是否达标</th>
<th>测试方案简述与测量仪器</th>
</tr>
</thead>
<tbody>
<tr>
<td>该电路特性测试仪能判断放大器电路元器件变化而引起故障或变化 的原因。</td>
<td>任意开路或短路 R1~R4 中的一个电阻，电路特性测试仪能 够判断并显示故障原因。</td>
<td></td>
<td></td>
<td>使用搭建系统自动测量。</td>
</tr>
<tr>
<td></td>
<td>任意开路 C1~C3 中的一个电容，电路特性测试仪能够判断并显示故 障原因。</td>
<td></td>
<td></td>
<td>使用搭建系统自动测量。</td>
</tr>
<tr>
<td></td>
<td>任意增大 C1~C3 中的一个电容的容量，使其达到原来值的两倍。电 路特性测试仪能够判断并显示该变化的原因。</td>
<td></td>
<td></td>
<td>使用搭建系统自动测量。</td>
</tr>
<tr>
<td></td>
<td>在判断准确的前提下，提高判断速度，每项判断时间不超过 2 秒。</td>
<td></td>
<td></td>
<td>使用搭建系统自动测量。</td>
</tr>
<tr>
<td>其他。</td>
<td>其他。</td>
<td>未完成</td>
<td>否</td>
<td>无</td>
</tr>
</tbody>
</table>
</div>
<h2 id="五、结论"><a href="#五、结论" class="headerlink" title="五、结论"></a>五、结论</h2><p>在本次训练当中，本组硬件和软件工作总结如下：</p>
<ul>
<li><strong>硬件</strong>：<ul>
<li>通过对于给出待测电路图的仿真，数据分析，总结输入输出特性，故障特点，列出故障清单，方便软件通过电路信息比对获取信息支持。</li>
<li>综合软件限制条件以及电路自身限制，搭建待测元件的外围辅助测量电路。<ul>
<li>搭建信号衰减器使DDS能够给待测电路提供合理的输入电压。</li>
<li>对于待测电路相关重要位置进行结构优化，使用继电器接入采样电阻，配合软件ADC完成对于电路测量工作点的选择。</li>
</ul>
</li>
</ul>
</li>
<li><strong>软件</strong>：<ul>
<li>进行STM32H7系列DSP库的尝试，结合其特点撰写可复用性高的FFT运算模块。</li>
<li>进行系统的总体把握，使用状态机、特殊结构体让系统满足自动化和高内聚，低耦合特点。</li>
<li>使用串口屏等进行外部数据交互的直观显示，并撰写配套代码。</li>
<li>为满足自动化要求，撰写基于DMA定时器同步采样的自动扫频和频谱模值、幅度点选取程序，能够结合FFT获得信号特征。</li>
</ul>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E7%BC%96%E7%A8%8B%E5%AD%A6%E4%B9%A0-STM32-%E5%B5%8C%E5%85%A5%E5%BC%8F/" rel="tag"># 编程学习,STM32,嵌入式</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2022/06/04/hello-world/" rel="prev" title="Hello World">
      <i class="fa fa-chevron-left"></i> Hello World
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E7%B3%BB%E7%BB%9F%E6%96%B9%E6%A1%88"><span class="nav-number">1.</span> <span class="nav-text">一、系统方案</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#1-1-%E6%96%B9%E6%A1%88%E7%9A%84%E6%AF%94%E8%BE%83%E4%B8%8E%E9%80%89%E6%8B%A9"><span class="nav-number">1.1.</span> <span class="nav-text">1.1  方案的比较与选择</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%8F%96%E6%A0%B7%E7%94%B5%E9%98%BB%E6%8E%A5%E5%85%A5%E6%96%B9%E6%B3%95%E7%9A%84%E9%80%89%E6%8B%A9"><span class="nav-number">1.1.1.</span> <span class="nav-text">(1) 取样电阻接入方法的选择</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#i-%E4%BD%BF%E7%94%A8%E6%A8%A1%E6%8B%9F%E5%BC%80%E5%85%B3%E8%BF%9B%E8%A1%8C%E6%8E%A5%E5%85%A5%E5%88%87%E6%8D%A2"><span class="nav-number">1.1.1.1.</span> <span class="nav-text">i. 使用模拟开关进行接入切换</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ii-%E4%BD%BF%E7%94%A8%E7%BB%A7%E7%94%B5%E5%99%A8%E8%BF%9B%E8%A1%8C%E6%8E%A5%E5%85%A5%E5%88%87%E6%8D%A2"><span class="nav-number">1.1.1.2.</span> <span class="nav-text">ii.使用继电器进行接入切换</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-%E5%A4%84%E7%90%86%E5%99%A8%E6%96%B9%E6%A1%88%E7%9A%84%E9%80%89%E6%8B%A9"><span class="nav-number">1.1.2.</span> <span class="nav-text">(2)  处理器方案的选择</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#i-%E4%BD%BF%E7%94%A8STM32F1%E7%B3%BB%E5%88%97MCU"><span class="nav-number">1.1.2.1.</span> <span class="nav-text">i.使用STM32F1系列MCU</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ii-%E4%BD%BF%E7%94%A8STM32H7%E7%B3%BB%E5%88%97%E4%BA%A7%E5%93%81%E7%BA%BF"><span class="nav-number">1.1.2.2.</span> <span class="nav-text">ii.使用STM32H7系列产品线</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E6%A8%A1%E6%95%B0%E8%BD%AC%E6%8D%A2%E5%99%A8%E7%9A%84%E9%80%89%E6%8B%A9"><span class="nav-number">1.1.3.</span> <span class="nav-text">(3)  模数转换器的选择</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#i-%E4%BD%BF%E7%94%A8%E7%89%87%E5%A4%96ADC%E9%87%87%E6%A0%B7"><span class="nav-number">1.1.3.1.</span> <span class="nav-text">i.使用片外ADC采样</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#a-%E4%BD%BF%E7%94%A8ADS1256"><span class="nav-number">1.1.3.1.1.</span> <span class="nav-text">a)使用ADS1256</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#b-%E4%BD%BF%E7%94%A8AD7606"><span class="nav-number">1.1.3.1.2.</span> <span class="nav-text">b)使用AD7606</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ii-%E4%BD%BF%E7%94%A8%E7%89%87%E4%B8%8AADC%E9%87%87%E6%A0%B7"><span class="nav-number">1.1.3.2.</span> <span class="nav-text">ii.使用片上ADC采样</span></a></li></ol></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#1-2-%E6%96%B9%E6%A1%88%E6%8F%8F%E8%BF%B0"><span class="nav-number">1.2.</span> <span class="nav-text">1.2 方案描述</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E7%90%86%E8%AE%BA%E5%88%86%E6%9E%90%E4%B8%8E%E8%AE%A1%E7%AE%97"><span class="nav-number">2.</span> <span class="nav-text">二、理论分析与计算</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1-%E5%BE%85%E6%B5%8B%E7%94%B5%E8%B7%AF"><span class="nav-number">2.1.</span> <span class="nav-text">2.1  待测电路</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2-%E4%BF%A1%E5%8F%B7%E5%8F%91%E7%94%9F%E5%92%8C%E8%A1%B0%E5%87%8F"><span class="nav-number">2.2.</span> <span class="nav-text">2.2  信号发生和衰减</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3-%E6%B5%8B%E9%87%8F%E7%94%B5%E8%B7%AF%E6%A8%A1%E5%9D%97"><span class="nav-number">2.3.</span> <span class="nav-text">2.3  测量电路模块</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4-%E5%A4%84%E7%90%86%E5%99%A8%E6%A8%A1%E5%9D%97"><span class="nav-number">2.4.</span> <span class="nav-text">2.4  处理器模块</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E7%94%B5%E8%B7%AF%E4%B8%8E%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.</span> <span class="nav-text">三、电路与程序设计</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.1.</span> <span class="nav-text">3.1 电路设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E5%BE%85%E6%B5%8B%E7%94%B5%E8%B7%AF%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.1.1.</span> <span class="nav-text">(1)  待测电路设计</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.2.</span> <span class="nav-text">3.2 程序设计</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-%E7%A8%8B%E5%BA%8F%E4%B8%BB%E4%BD%93%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.2.1.</span> <span class="nav-text">(1) 程序主体设计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-FFT%E9%87%87%E6%A0%B7%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.2.2.</span> <span class="nav-text">(2)  FFT采样设计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-%E8%BE%93%E5%85%A5%E7%94%B5%E9%98%BB%E6%B5%8B%E9%87%8F%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.2.3.</span> <span class="nav-text">(3)  输入电阻测量设计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#4-%E8%BE%93%E5%87%BA%E7%94%B5%E9%98%BB%E6%B5%8B%E9%87%8F%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.2.4.</span> <span class="nav-text">(4)  输出电阻测量设计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E6%B1%82%E8%A7%A3%E5%A2%9E%E7%9B%8A%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.2.5.</span> <span class="nav-text">(5)  求解增益程序设计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#5-%E6%89%AB%E9%A2%91%E6%A8%A1%E5%9D%97%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.2.6.</span> <span class="nav-text">(5)   扫频模块程序设计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#6-%E5%8F%91%E5%B1%95%E6%8C%87%E6%A0%87%E6%B5%8B%E9%87%8F%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.2.7.</span> <span class="nav-text">(6)  发展指标测量设计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#7-%E6%98%BE%E7%A4%BA%E6%A8%A1%E5%9D%97%E7%A8%8B%E5%BA%8F%E8%AE%BE%E8%AE%A1"><span class="nav-number">3.2.8.</span> <span class="nav-text">(7)  显示模块程序设计</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9B%9B%E3%80%81%E6%B5%8B%E8%AF%95%E6%96%B9%E6%A1%88%E4%B8%8E%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C"><span class="nav-number">4.</span> <span class="nav-text">四、测试方案与测试结果</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A81-%E5%9F%BA%E6%9C%AC%E8%A6%81%E6%B1%82%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C"><span class="nav-number">4.1.</span> <span class="nav-text">表1 基本要求测试结果</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A1%A82-%E5%8F%91%E6%8C%A5%E9%83%A8%E5%88%86%E6%B5%8B%E8%AF%95%E7%BB%93%E6%9E%9C"><span class="nav-number">4.2.</span> <span class="nav-text">表2 发挥部分测试结果</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%94%E3%80%81%E7%BB%93%E8%AE%BA"><span class="nav-number">5.</span> <span class="nav-text">五、结论</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="MALossov"
      src="/uploads/avator.png">
  <p class="site-author-name" itemprop="name">MALossov</p>
  <div class="site-description" itemprop="description">是很菜的人的很菜的博客捏，无栈工程学徒ing。</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives">
          <span class="site-state-item-count">30</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">25</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/malossov" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;malossov" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/yi-wan-nzlao-si-ji" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;yi-wan-nzlao-si-ji" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>知乎</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://gitee.com/malossov" title="Gitee → https:&#x2F;&#x2F;gitee.com&#x2F;malossov" rel="noopener" target="_blank"><i class="fab fa-gitee fa-fw"></i>Gitee</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2022</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">MALossov</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://pisces.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Pisces</a>
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>


  <script defer src="/lib/three/three.min.js"></script>
    <script defer src="/lib/three/three-waves.min.js"></script>


  















  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
          load: ['[tex]/mhchem'],
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
          packages: {'[+]': ['mhchem']},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/love.js"></script>
<!-- 背景动画 -->
<script type="text/javascript" src="/js/src/particle.js"></script>


</body>
</html>
